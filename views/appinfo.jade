//
  Created by liangjingyue on 11/18/16.

extends new_index

block main_content
  - var _name = original_name;//.toString().replace(".apk","");
  - var usename = name;
  - var riskEva = perms;
  - var logo = image.replace("64","100");
  - var levels = ['A','B','C','D','E'];
  - var permissionGroup = ["Identity","Device & app history","Device ID & call", "Contacts", "Calendar", "Location", "SMS", "Phone", "Photos/Media/Files", "Microphone", "Camera", "Internet", "Bluetooth"];
  .container-fluid
    .row-fluid
      .col-lg-4
        img.img-responsive.img-rounded(src = logo,style='width:70%; height:70%;')
      .col-lg-6
        h3
          a(href='https://play.google.com/store/apps/details?id=' + _name) #{usename}
        - console.log(_name);
        h3 风险分析
          p.lead
          - var floatX = Math.round(riskEva["Score"] * 100) / 100;
          - var level = riskEva["SafeClass"];
          - var result = levels[level-1]+" ( "+floatX+" )";
          - var colorstring = "000";

          - if(level==1){
          -     console.log(level)
          -     colorstring = "32cd32"
          - }
          - if(level==2){
          -     console.log(level)
          -     colorstring = "7fff00"
          - }
          - if(level==3){
          -     console.log(level)
          -     colorstring = "CDAD00"
          - }
          - if(level==4){
          -     console.log(level)
          -     colorstring = "EE9A00"
          - }
          - if(level==5){
          -     console.log(level)
          -     colorstring = "f00"
          - }
          - var colorstyle = "color: #"+colorstring+";";
          p(style= colorstyle) RiskEva: #{result}

    .row-fluid
      .col-lg-11
        h3 权限使用
        script(type='text/javascript').
          function f1(group) {
            if (document.getElementById(group).style.display == 'none') {
              document.getElementById(group).style.display = 'block'
            }
            else {
              document.getElementById(group).style.display = 'none'
            }
          }
        - var j=-1;
        - while(j<10) {
          - j = j+1;
          - var group = permissionGroup[j];
          -if(riskEva[group]!=null)
            h4(onclick='f1(\"'+group+'\");') #{group}
            ul.list-unstyled(id = group style='display:none;')
              - each perm in riskEva[group]
                li #{perm}
        -}

        - if(riskEva['Not used by 3rd-party library'].length>0)
          h4(onclick='f1(\"third\");') 第三方应用不应该使用的权限
          ul.list-unstyled(id = "third" style='display:none;')
            each perm in riskEva['Not used by 3rd-party library']
              li #{perm}
    .row-fluid
      .col-lg-11
        h3 权限使用
        table.table.table-responsive.table-hover
          - var j=-1;
          - while(j<10) {
            - j = j+1;
            - var group = permissionGroup[j];
            -if(riskEva[group]!=null)
              thead
                tr
                  th #{group}
              tbody
                ul.list-unstyled(id = group style='display:none;')
                  - each perm in riskEva[group]
                    tr
                      td #{perm}
          - }
    .row-fluid
      .col-lg-10
        h3 包含的库
        - var local_libs = JSON.parse(libs)
        - console.log(local_libs)
        - if (local_libs.length != 0)
          table.table.table-responsive.table-hover
            thead
              tr
                th Library Name
                th Common Package Name
                th Current Package Name
                th Library Type
                th Popularity
                th Web Link
                th Permissions
              tbody
            each obj in local_libs
              tr
                td= obj['lib']
                - if (obj['pn'].length > 22) {
                  td
                    p.long_pn(data-toggle='tooltip' title=obj['pn'].toString().replace(/\//g, ' / '))= obj['pn'].substr(0, 20) + '...'
                - }
                - else
                  td= obj['pn']
                - if (obj['cpn'].length > 22) {
                  td
                    p.long_pn(data-toggle='tooltip' title=obj['cpn'].toString().replace(/\//g, ' / '))= obj['cpn'].substr(0, 20) + '...'
                -}
                - else
                  td= obj['cpn']
                  td=obj['tp']
                  td= obj['dn']
                  td
                    - var web_link = obj['ch']
                    - if (web_link == undefined || web_link == "")
                      p &nbsp;
                    - else
                      - if (web_link.substr(0, 4) != "http") { web_link = 'http://' + web_link;
                        a(href= web_link target="_blank") Link
                      - }
                      - else
                        a(href= web_link target="_blank") Link
                  td
                    - var detailed_information = obj['p'].toString().replace(/,/g, '   ');
                    - if( detailed_information != "")
                      button.pop(rel="popover" data-content=detailed_information data-original-title="Detailed Permission Info") Details
                    - else
                      button.pop(rel="popover" data-content="No Android Permission Used." data-original-title="Detailed Permission Info") None
        - else
          p None.

        hr.featurette-divider
        footer
          p.pull-right
            a(href = '#') Back to top
            p
            | © 2016 北京大学(天津滨海)新一代信息技术研究院. ·
            a(href = '#') Privacy
            |  ·
            a(href = '#') Terms
